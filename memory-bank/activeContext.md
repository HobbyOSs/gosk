# activeContext.md

## 現在の作業の焦点
実装項目の整理 #5 の対応。オペランドの種別判定の実装とテストを完了させること。

## 直近の変更点
- `ast`パッケージ内に`Operand`インターフェースを定義。
- x86リファレンスのXMLを基に、YAML形式の`asmdb`を作成。
- 文字列をパースしてアドレス種別およびオペランド種別を判定する実装を追加。
- ファイル`junkjit/x86/operand_impl.go`および`gosk/ast/operand.go`に変更を加えた。
- Issue #5 のコメントを反映し、`ocode`中間言語の実装とスタックマシンの概念を検討。

## 次のステップ
- YAMLの`asmdb`を使用してオペランドの検索キーを構築し、必要な機械語や機械語のサイズを取得する機能を完成させる。
- 中間言語としての`ocode`の実装を進める。
- スタックマシン構造の概念を活用しつつ、疎結合な設計を維持する。
- e2eテストを強化し、現行のテストが堅牢であることを確認する。
- スタックマシン関連の構造を検討し、プロジェクトの構造簡素化を図る。

## アクティブな決定事項と考慮事項
- アセンブリ文の構造を簡素化し、テストの容易性を高めるために、現行の設計を再評価。
- `opcode`やオペランドの種別判定において、既存のx86リファレンスデータを厳密に遵守。
- `asmdb`のXMLデータを活用することで、テキストベースの資料がない場合でも必要な情報を確保。
- プロジェクトの進行中に見つかった課題として、疎結合ではない設計がe2eテストの妨げとなっているため、設計の見直しを進行中。
- `ocode`中間言語の導入により、テストと拡張性の向上を目指す。
- プロジェクトの構造を管理しやすくするため、スタックマシンの概念を採用する方向で検討。
