# System Patterns

## システムアーキテクチャ
- モジュール化されたコンポーネント設計
- 各コンポーネントは独立してテスト可能

## 主要な技術的決定
- Go言語を使用した高性能なコード解析
- ASTを用いた中間表現の生成

## 使用している設計パターン
- ファクトリーパターンによるオブジェクト生成
- ストラテジーパターンによるアルゴリズムの選択

## プロジェクトのディレクトリ構成
- /cmd/: 各エントリポイント
  - gosk/: アセンブラのCLI
- /internal/: 内部実装 (外部パッケージには非公開)
  - ast/: AST (抽象構文木) 関連
  - frontend/: プログラムのエントリーポイント
  - gen/: PEG で記述されたパーサ
  - pass1/: AST の１回めの解析（機械語サイズとラベル、マクロ）
  - pass2/: AST の後処理（ELF,COFFファイルの処理、機械語生成はcodegenで実施）
  - codegen/: x86 コード生成
- /pkg/: 外部公開モジュール
  - asmdb/: x86アセンブラ命令情報
    - json-x86-64/x86_64.json: x86命令のオペランドやエンコード方式を格納したJSONデータ (git submodule)
    - JSONデータの検索機能を提供し、アセンブラ命令の実装に必要な情報を取得
  - operand/: x86アセンブラオペランド処理ライブラリ
  - ocode/: Ocode モジュール (中間言語の定義)

## コンポーネント間の関係
- フロントエンドはASTを生成し、バックエンドに渡す
- バックエンドはASTを基に中間表現を生成し、最終コードを出力
- `pkg/asmdb` はx86命令の情報をJSONファイルから取得し、オペコード、オペランド、エンコーディングなどの情報を提供する

## 関連情報
[implementation_details.md](./implementation_details.md)
[technical_notes.md](./technical_notes.md)
